# yaml-language-server: $schema=https://taskfile.dev/schema.json
---
version: '3'

tasks:
    test:
        desc: "Run tests and watch files for changes"
        cmds:
            - go install gotest.tools/gotestsum@latest
            - gotestsum -f testname -- -v -count=1 ./...
            - gotestsum -f testname --watch  -- -v -count=1 ./...
    bench:
        desc: "Run benchmarks and watch files for changes"
        cmds:
            - go install gotest.tools/gotestsum@latest
            - gotestsum -f standard-verbose -- -v -count=1 -bench=. -benchmem ./...
            - gotestsum -f standard-verbose --watch  -- -v -count=1 -bench=. -benchmem ./...
    bench-5s:
        desc: "Run benchmarks and watch files for changes"
        cmds:
            - go install gotest.tools/gotestsum@latest
            - gotestsum -f standard-verbose -- -v -count=1 -bench=. -benchmem -benchtime 5s ./...
            - gotestsum -f standard-verbose --watch  -- -v -count=1 -bench=. -benchmem -benchtime 5s ./...
    run-test:
        desc: "Run tests once"
        cmds:
            - go install gotest.tools/gotestsum@latest
            - gotestsum -f testname -- -v -count=1 ./...
    fmt:
        desc: "Format all files"
        cmds:
            - go fmt -x ./...
    fix:
        desc: "Fix all files"
        cmds:
            - go fix ./...
    vet:
        desc: "Analyze all files"
        cmds:
            - go vet ./...
    auto:
        desc: "Run on change"
        sources:
            - ./**/*.go
        generates:
            - ./**/*.go
        watch: true
        deps:
            - run-test
            - fmt
            - fix
            - vet
